\documentclass[11pt,twoside]{article}
\usepackage{asp2014}

\aspSuppressVolSlug
\resetcounters

\bibliographystyle{asp2014}

\markboth{Mueller et al.}{Qserv Distributed Petascale Database}

\begin{document}
%\ssindex{LSST}
%\ssindex{databases!petascale}
%\ssindex{observatories!ground-based!LSST}
%\ssindex{observatories!ground-based!Rubin}

\title{Qserv: A Distributed Petascale Database for the LSST Catalogs}

\input{authors}

\begin{abstract}
Qserv is a distributed, shared-nothing, SQL database system being developed by the Vera Rubin Observatory to
host the multi-petabyte astronomical catalogs that will be produced by the LSST survey.  Here we sketch the
basic design and operating principles of Qserv, and provide some updates on recent developments.
\end{abstract}

\section{Introduction}

The Legacy Survey of Space and Time \citep{2019ApJ...873..111I} is a "deep fast wide" optical/near-IR survey
of half the sky in \emph{ugrizy} bands to \emph{r} 27.5 (36\,nJy) based on 825 visits over a 10-year period,
to be carried out by the Vera C.\ Rubin Observatory in Chile.

The astronomical catalogs to be produced by the survey are notionally described in \citet{LSE-163}, and the
corresponding database schema is described in \citet{LDM-153}.  By the 10th year of the survey, the catalog
database is expected to run to approximately 60 trillion rows, requiring more than 10 petabytes of storage
before considerations for replication, indices, or other overheads.

At the outset of construction, the project could not identify a mature database product capable of operating
at these scales while also meeting project requirements for robust spherical geometry, predictable query
response under heavy concurrent load, platform/hardware affordability, and open source licensing.  The Rubin
Observatory Data Management team thus embarked on the design and implementation of Qserv.

\section{The Qserv Approach}

The evolution and progress of Qserv has been previously reported in \citet{2006SPIE.6270E..0RB},
\citet{2011Wang:2011:QDS:2063348.2063364}, and \citet{LDM-135}.  Principal design elements are as follows:

\subsection{Distributed and Parallel}

Qserv is designed as a parallel database, where catalog data is spatially partitioned and distributed
uniformly over a collection of shared-nothing back-end nodes.  Queries are handled in a "map/reduce" paradigm:
after arriving at a SQL proxy, queries are analyzed for spatial coverage and rewritten into a collection of
supporting partial queries which are then distributed to involved back-end nodes for execution ("map"). The
results of these partial queries are subsequently returned to the proxy node where they are aggregated and any
necessary summary statistics computed ("reduce"); results are then returned to the user.

\subsection{Partitioning and Replication}

Qserv divides data into spatial partitions of roughly the same area.  Since partitions are small with respect
to higher-density areas of the survey and spread over back-end using a non-area-based scheme,
density-differential-induced skew is averaged out among the nodes.

Qserv additionally stores a precomputed amount of overlapping data from spatially adjacent partitions
alongside each partition.  Using this data, spatial joins can be computed correctly within a preset
distance without needing data from other partitions that may be located on other nodes.

Data partitions are dynamically replicated across back-end nodes, for resilience and high-availability.  If a
node becomes unavailable, Qserv is capable of re-dispatching in-flight partial queries involving partitions on
that node toward other available partition replicas transparently to the user.  Partitions that become
under-represented will be re-replicated and the cluster re-balanced in the background.  The same facility
enables adding nodes to a Qserv cluster or draining nodes for maintenance as online operations.

\subsection{Shared Scans}

...

\subsection{Off-the-shelf, Open Source Components}

...

\acknowledgements This material or work is supported in part by the National Science Foundation through
Cooperative Agreement AST-1258333 and Cooperative Support Agreement AST1836783 managed by the Association of
Universities for Research in Astronomy (AURA), and the Department of Energy under Contract No.
DE-AC02-76SF00515 with the SLAC National Accelerator Laboratory managed by Stanford University.

\bibliography{C15}

\end{document}
